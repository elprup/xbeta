{"id":588,"date":"2008-10-19T08:00:32","date_gmt":"2008-10-19T00:00:32","guid":{"rendered":"http://xbeta.info/?p=588"},"modified":"2008-10-19T08:00:32","modified_gmt":"2008-10-19T00:00:32","slug":"tc-unpack","status":"publish","link":"https://xbeta.info/tc-unpack.htm","title":{"rendered":"TC-unpack.ahk：TC解压助手 v0.9"},"content":{"rendered":"<p><a href=\"http://xbeta.info/tc-unpack.htm\">TC-unpack</a>（TC解压助手）是用来辅助TC（Total Commander）解压功能的一小段AutoHotkey脚本，用来在解压对话框中自动按键，功能有二：一是删除解压路径，以解压到当前目录；二是选中“Unpack each archive to a &amp;separate subdir (name of the archive)”/“将各压缩包分别解压到同名的子文件夹中(&amp;S)”项，以实现把文件名作为解压后的目录名。<br />\n<img decoding=\"async\" src=\"https://img.xbeta.info/tcunpack.png\" alt=\"tc-unpack.ahk\" /></p>\n<p>在TC的中、英文论坛中，都常有网友建议自动解压到当前目录（而非对面窗口）、自动（或默认）解压到同名子目录，但TC并未实现此功能。这算是本程序的大背景。小背景则是新网友daizhaolin来信，提出了这一要求。</p>\n<p>其实，我自己很懒，多数时候都是手工按键的。并且这样做有一个好处，就是能发现压缩包内是散着的N个文件，还是已经包含在一个目录中。如果是前者，则选建目录再解压入其中；如果是后者，则直接解压。但从我的观点来看，<span style=\"color: red;\">提倡压缩包内含目录</span>。理由是，我们要提供<span style=\"color: red;\">一个完整解决方案，而非散乱的零部件</span>。但是，遇到更懒（或称为更勤于追求自动化高效率）的网友，我仍愿意提供如下脚本。朋友们可自由借鉴、使用、指正、传播。</p>\n<h2>源代码1</h2>\n<p>下面是善用佳软作为ahk的不求深解者写的代码，特点是用最简单的ahk语句，完全模拟击键实现功能。（注：如下代码的高亮格式由gvim生成）</p>\n<div style=\"border-left:2px solid gray;margin-left:2em;padding-left:1em; background-color:#333333;color:#ffffff;\"><span style=\"font-family: monospace;\"><span style=\"color: #80a0ff;\">;TC-unpack（TC解压助手）v0.9/081017</span><br />\n<span style=\"color: #80a0ff;\">;主页：<a href=\"http://xbeta.info/tc-unpack.htm\">http://xbeta.info/tc-unpack.htm</a></span></span><span style=\"font-family: monospace;\"><span style=\"color: #ff80ff;\">#</span><span style=\"color: #ff80ff;\">singleinstance</span>,force<br />\n<span style=\"color: #ffff60;\"><strong>SetTitleMatchMode</strong></span>, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">2</span></span></span></p>\n<p><span style=\"font-family: monospace;\"><span style=\"color: #80a0ff;\">;本段程序功能：在TC中，按alt+F9出现解压对话框后，自动清空解压目录，这样就解压到当前目录了。</span><br />\n<span style=\"color: #60ff60;\"><strong>!F9::</strong></span><br />\nIfWinActive Total Commander<br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>sendplay</strong></span>, !{F9}<br />\n<span style=\"color: #ffff60;\"><strong>WinWaitActive</strong></span>, Unpack files <span style=\"color: #80a0ff;\">;这是等待解压对话框出现，如果是中文版本，应该把Unpack files换为对应的中文窗口标题，或换为 ahk_class TDLGUNZIPALL</span><br />\n<span style=\"color: #ffff60;\"><strong>send</strong></span>, {del}<br />\n<span style=\"color: #80a0ff;\">;send, {enter} </span><br />\n<span style=\"color: #80a0ff;\">;如果你想自动按下回车，请取消上一行的注释。后果自负！</span><br />\n}<br />\n<span style=\"color: #ffff60;\"><strong>else</strong></span><br />\n<span style=\"color: #ffff60;\"><strong>sendplay</strong></span>, !{F9} <span style=\"color: #80a0ff;\">;保证在其他程序中，不影响Alt+F9的正常功能。</span><br />\n<span style=\"color: #ffff60;\"><strong>return</strong></span></span></p>\n<p><span style=\"font-family: monospace;\"><span style=\"color: #80a0ff;\">;本段程序功能：在TC中，按ctrl+alt+F9出现解压对话框后，自动清空解压目录，自动选中“Unpack each archive to a &amp;separate subdir (name of the archive)”。语句基本同上。</span><br />\n<span style=\"color: #60ff60;\"><strong>^!F9::</strong></span><br />\nIfWinActive Total Commander<br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>sendplay</strong></span>, !{F9}<br />\n<span style=\"color: #ffff60;\"><strong>WinWaitActive</strong></span>, Unpack files<br />\n<span style=\"color: #ffff60;\"><strong>send</strong></span>, {del}<br />\n<span style=\"color: #ffff60;\"><strong>send</strong></span>, !s <span style=\"color: #80a0ff;\">;自动按下alt+s，让TC选中该选项</span><br />\n<span style=\"color: #80a0ff;\">;send, {enter}</span><br />\n}<br />\n<span style=\"color: #ffff60;\"><strong>else</strong></span><br />\n<span style=\"color: #ffff60;\"><strong>sendplay</strong></span>, ^!{F9}<br />\n<span style=\"color: #ffff60;\"><strong>return</strong></span></span></div>\n<h2>源代码2</h2>\n<p>以下是Jameson给出的ahk代码，更通用，更可靠，效率也更高。<br />\n说明1：下述代码及Jameson留言中的“PostMessage, 0×111”，0与111之间是字母x（xbeta的x），而不是其他符号。复制代码后请注意替换，以免WordPress自动转换的影响。<br />\n说明2：我试用如下代码未能执行，或许是postmessage中 control id不同的原因。我在中文XP SP2下，用官方标准的Total Commander 7.04a 英文版，control id为4，可以正常运行。</p>\n<div style=\"border-left:2px solid gray;margin-left:2em;padding-left:1em; background-color:#333333;color:#ffffff;\"><span style=\"font-family: monospace;\"><span style=\"color: #80a0ff;\">;Jameson改进版本</span><br />\n<span style=\"color: #ff80ff;\">#</span><span style=\"color: #ff80ff;\">NoEnv</span> <span style=\"color: #80a0ff;\">; Recommended for performance and compatibility with future AutoHotkey releases.</span><br />\n<span style=\"color: #ff80ff;\">#</span><span style=\"color: #ff80ff;\">singleinstance</span> force<br />\n<span style=\"color: #ffff60;\"><strong>SendMode</strong></span> <span style=\"color: #ffff60;\"><strong>Input</strong></span> <span style=\"color: #80a0ff;\">; Recommended for new scripts due to its superior speed and reliability.</span><br />\n<span style=\"color: #ffff60;\"><strong>SetWorkingDir</strong></span> <span style=\"color: #40ffff;\">%</span><span style=\"color: #ff80ff;\">A_ScriptDir</span><span style=\"color: #40ffff;\">%</span> <span style=\"color: #80a0ff;\">; Ensures a consistent starting directory.</span></span><span style=\"font-family: monospace;\"><span style=\"color: #ff80ff;\">#</span><span style=\"color: #ff80ff;\">IfWinActive</span> <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TTOTAL_CMD <span style=\"color: #80a0ff;\">;这一句的作用是，当 TC 激活时热键才生效。用类名判断，通用性比较好，中英文界面都可以。</span><br />\n<span style=\"color: #60ff60;\"><strong>!F9::</strong></span><br />\n<span style=\"color: #80a0ff;\">;~ send, !{F9}</span><br />\n<span style=\"color: #ffff60;\"><strong>PostMessage</strong></span>, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">0x111</span></span>, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">181</span></span>,,, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TTOTAL_CMD <span style=\"color: #80a0ff;\">;发送消息解压消息，同样是因为通用性比较好，不受快捷键的限制。</span><br />\n<span style=\"color: #ffff60;\"><strong>return</strong></span><br />\n<span style=\"color: #ffff60;\"><strong>msgbox</strong></span>,<span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">1</span></span><br />\n<span style=\"color: #ffff60;\"><strong>WinWaitActive</strong></span>, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TDLGUNZIPALL,, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">1</span></span> <span style=\"color: #80a0ff;\">;如果选择的是不能解压的文件会弹出错误窗口，限制等待时间为 1 秒，如果等不到解压窗口就退出。</span><br />\n<span style=\"color: #ffff60;\"><strong>If</strong></span> <span style=\"color: #ff80ff;\">ErrorLevel</span><br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>Return</strong></span><br />\n}<br />\n<span style=\"color: #ffff60;\"><strong>Else</strong></span><br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>controlSend</strong></span>,, {Del}, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TDLGUNZIPALL<br />\n}<br />\n<span style=\"color: #80a0ff;\">;send, {enter}</span><br />\n<span style=\"color: #ffff60;\"><strong>Return</strong></span></span></p>\n<p><span style=\"font-family: monospace;\"><span style=\"color: #60ff60;\"><strong>^!F9::</strong></span><br />\n<span style=\"color: #80a0ff;\">;~ sendplay, !{F9}</span><br />\n<span style=\"color: #ffff60;\"><strong>PostMessage</strong></span>, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">0x111</span></span>, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">181</span></span>,,, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TTOTAL_CMD<br />\n<span style=\"color: #ffff60;\"><strong>WinWaitActive</strong></span>, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TDLGUNZIPALL,, <span style=\"background-color: #0d0d0d\"><span style=\"color: #ffa0a0;\">1</span></span><br />\n<span style=\"color: #ffff60;\"><strong>If</strong></span> <span style=\"color: #ff80ff;\">ErrorLevel</span><br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>Return</strong></span><br />\n}<br />\n<span style=\"color: #ffff60;\"><strong>Else</strong></span><br />\n{<br />\n<span style=\"color: #ffff60;\"><strong>controlSend</strong></span>,, {Del}, <span style=\"color: #60ff60;\"><strong>ahk_class</strong></span> TDLGUNZIPALL<br />\n<span style=\"color: #ffff60;\"><strong>Send</strong></span>, !S<br />\n}<br />\n<span style=\"color: #80a0ff;\">;send, {enter}</span><br />\n<span style=\"color: #ffff60;\"><strong>Return</strong></span></span></div>\n<h2>说明</h2>\n<p>如果你有AutoHotkey的基本知识，并且安装了AutoHotkey，看过了上述说明，就可以使用tc-unpack.ahk了。阅读<a title=\"Total Commander学堂第3讲：压缩及插件\" href=\"http://xbeta.info/studytc/tc003.htm\">TC学堂第3讲：压缩及插件</a>、善用佳软<a href=\"http://xbeta.info/tag/autohotkey-ahk\">AutoHotkey系列文章</a>也会帮你了解更多技巧。</p>\n","protected":false},"excerpt":{"rendered":"<p>TC-unpack（TC解压助手）是用来辅助TC（Total Commander）解压功能的一小段AutoHo [&hellip;]</p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":["未分类","系统工具"],"tags":["AutoHotkey","Total Commander","all"],"_links":{"self":[{"href":"https://xbeta.info/wp-json/wp/v2/posts/588"}],"collection":[{"href":"https://xbeta.info/wp-json/wp/v2/posts"}],"about":[{"href":"https://xbeta.info/wp-json/wp/v2/types/post"}],"author":[{"embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/users/2"}],"replies":[{"embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/comments?post=588"}],"version-history":[{"count":0,"href":"https://xbeta.info/wp-json/wp/v2/posts/588/revisions"}],"wp:attachment":[{"href":"https://xbeta.info/wp-json/wp/v2/media?parent=588"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/categories?post=588"},{"taxonomy":"post_tag","embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/tags?post=588"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]},"wp_type":"post"}