{"id":1141,"date":"2010-09-19T11:27:34","date_gmt":"2010-09-19T03:27:34","guid":{"rendered":"http://xbeta.info/?p=1141"},"modified":"2010-09-19T11:27:34","modified_gmt":"2010-09-19T03:27:34","slug":"gvim-powerword-ciba","status":"publish","link":"https://xbeta.info/gvim-powerword-ciba.htm","title":{"rendered":"支持非等宽字体、屏幕取词的gvim v7.3"},"content":{"rendered":"<p>关于更适合中文用户、更适合非编程用户的vim的讨论（<a href=\"http://xbeta.info/zhvim.htm\" title=\"《拿起画笔，描绘你心中的Vim》补充说明\">1</a>、<a href=\"http://xbeta.info/zhvim-2.htm\" title=\"《拿起画笔，描绘你心中的Vim》\">2</a>）终于取得了一点实质性结果：<strong>支持非等款字体</strong>、<strong>支持金山词霸、有道词典取词</strong>的 windows gvim.exe v7.3 终于出现了。感谢 Dieken、湖间小筑的技术研究、动手制作。<br />\n<img decoding=\"async\" src=\"https://img.xbeta.info/gvim-xdict.png\" alt=\"[image]支持金山词霸取词的gvim修改版\"></p>\n<h3>一、gvim的屏幕取词</h3>\n<p><strong>问题描述：</strong><br />\n　　Windows下，金山词霸、有道词典启用屏幕取词功能，但在gvim窗口中无法取词，或不能准确地取出完整单词。<br />\n<strong>原因分析：</strong><br />\n　　程序沟通问题。<br />\n　　跨平台、跨语言的gvim考虑了更复杂的情况（但没有区分）：并非所有文字都是从左向右阅读，某些语言会从右向左，如阿拉伯语等。而金山词霸、有道未充分考虑此情况。</p>\n<blockquote><p>\nDieken @ newsmth，2007-01-29, <a href=\"http://www.newsmth.net/bbstcon.php?board=VIM&#038;gid=26460\">via</a></p>\n<p>gvim 7.0.188 版本 gui_w32.c:gui_mch_draw_string():2255 这两行判断太严格了：<br />\n    if (os_version.dwPlatformId == VER_PLATFORM_WIN32_NT)<br />\n        foptions |= ETO_IGNORELANGUAGE;</p>\n<p>这个是为了 Hebrew 和 Arabic 文本加的，但是并没有加这个的判断， 我用<br />\n    if (<br />\n#ifdef FEAT_RIGHTLEFT<br />\n        curwin->w_p_rl &#038;&#038;<br />\n#endif<br />\n            os_version.dwPlatformId == VER_PLATFORM_WIN32_NT)<br />\n        foptions |= ETO_IGNORELANGUAGE;<br />\n实验了一下，在有两个窗口，一个没有设置 rightleft，一个设置了rightleft，当光标处于后者时，还是不能取词，需要光标挪到没有设置 rightleft 的窗口内才行，这个问题还不知道怎么改，交给邮件列表处理。</p>\n<p>对于大多数人来说，不会用到 rightleft 特性，所以可以<strong>直接把那两句注释掉，然后就可以正常取词了。</strong>\n</p></blockquote>\n<h2>二、gvim支持非等款字体</h2>\n<p>说明一：gvim 并非不能支持非等宽字体，而是在编译时，默认忽略了非等宽字体（Ignore non-monospace fonts without further ado）。在多个平台中，gtk2下的gvim是默认支持非等宽字体的，其他平台默认不支持。</p>\n<p>说明二：无论字体是否等宽，vim都会重新对齐。即显示效果仍然是等宽的。因此，『支持非等宽字体』的gvim，可以换用更丰富的字体，并不可以得到非等宽效果。</p>\n<p>解决办法一：非等宽字体编译时加 -DFEAT_PROPORTIONAL_FONTS 就可以了。make 的时候加一个参数。[via milksea @ newsmth]（这2句话是同一回事吗？哪位帮助整理成更准确、书面语的表述？）</p>\n<p>解决办法二：修改源代码，取消对非等宽字体的忽略。比如，在 os_mswin.c 中查找mono，会看到一处注释说忽略非等宽字体（Ignore non-monospace fonts without further ado），把下面一行注释掉即可。<a href=\"#gvim-f\">via</a></p>\n<h2>三、下载及讨论</h2>\n<p>支持非等宽字体、支持屏幕取词的 gvim.exe v7.3 <strong>下载</strong>，及相关<strong>讨论</strong>，敬请访问<br />\n<a href=\"http://www.hzmangel.info/blog/archives/724\" id=\"gvim-f\">让win下的vim支持非等宽字体</a>｜湖间小筑</p>\n<p>====<br />\n（完。初稿2007-01-23；更新2009-02-06；更新2009-05-07；更新2010-09-19）></iframe></p>\n","protected":false},"excerpt":{"rendered":"<p>关于更适合中文用户、更适合非编程用户的vim的讨论（1、2）终于取得了一点实质性结果：支持非等款字体、支持金山 [&hellip;]</p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":["未分类"],"tags":["gvim","all"],"_links":{"self":[{"href":"https://xbeta.info/wp-json/wp/v2/posts/1141"}],"collection":[{"href":"https://xbeta.info/wp-json/wp/v2/posts"}],"about":[{"href":"https://xbeta.info/wp-json/wp/v2/types/post"}],"author":[{"embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/users/2"}],"replies":[{"embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/comments?post=1141"}],"version-history":[{"count":0,"href":"https://xbeta.info/wp-json/wp/v2/posts/1141/revisions"}],"wp:attachment":[{"href":"https://xbeta.info/wp-json/wp/v2/media?parent=1141"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/categories?post=1141"},{"taxonomy":"post_tag","embeddable":true,"href":"https://xbeta.info/wp-json/wp/v2/tags?post=1141"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]},"wp_type":"post"}